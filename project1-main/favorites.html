<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>내가 찜한 카페</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="common.css">
</head>
<body>
  <header>
    <a href="index.html" class="home-link">처음으로</a>
    내가 찜한 카페
  </header>
  
  <main id="result"></main>

  <script src="favorites.js"></script>
  <script>
    let cafeData = [];

    // 찜한 카페 목록을 화면에 표시합니다.
    const displayFavorites = () => {
      const resultDiv = document.getElementById('result');
      const favoriteIds = getFavorites();
      
      if (favoriteIds.length === 0) {
        resultDiv.innerHTML = '<p style="text-align:center; margin-top: 2rem;">찜한 카페가 없습니다.</p>';
        return;
      }
      
      const favoriteCafes = cafeData.filter(cafe => favoriteIds.includes(cafe.id));

      resultDiv.innerHTML = favoriteCafes.map(cafe => `
        <div class="cafe">
          <img src="${cafe.image}" class="cafe-img" alt="${cafe.name}">
          <div class="cafe-info">
            <span class="favorite-btn" onclick="handleFavoriteClick(${cafe.id})">⭐</span>
            <h3>${cafe.name}</h3>
            <div class="cafe-features">${cafe.features.join(' · ')}</div>
          </div>
        </div>
      `).join('');
    };

    // 찜하기 버튼 클릭을 처리합니다.
    const handleFavoriteClick = (cafeId) => {
      toggleFavorite(cafeId);
      displayFavorites(); // 목록을 다시 그려서 즉시 반영
    };
  </script>
  <!-- Google Sheets API - 로그인 없이 공개 시트 불러오기 -->
<script src="https://apis.google.com/js/api.js"></script>
<script>
const API_KEY = "59921954313-37ma19fn61ovtdm7bpbqmalhp391v13i.apps.googleusercontent.com"; // ← 발급받은 실제 API 키로 교체
const SHEET_ID = "1eOyqB03QmpaW_b7CFWH6emkeAdOWLx170-Jk7PhcTFM";
const SHEET_RANGE = "Sheet1!A1:Z100";

gapi.load('client', () => {
  gapi.client.init({
    apiKey: API_KEY,
    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
  }).then(() => {
    gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: SHEET_ID,
      range: SHEET_RANGE,
    }).then(res => {
      const [header, ...rows] = res.result.values;
      const themeCols = ["THEME_1", "THEME_2", "THEME_3"];
      const featureCols = ["FEATURE_1", "FEATURE_2", "FEATURE_3", "FEATURE_4"];
      const menuCols = header.slice(12); // ✅ 메뉴 열 자동 인식

      cafeData = rows.map((row, idx) => {
        const rowObj = Object.fromEntries(header.map((h, i) => [h, row[i]]));

        return {
          id: idx + 1,
          name: rowObj.CAFE_NAME,
          lat: parseFloat(rowObj.LAT),
          lng: parseFloat(rowObj.LNG),
          image: rowObj.IMAGE,
          operatingHours: `${rowObj.OPEN}-${rowObj.CLOSE}`,
          theme: themeCols.map(k => rowObj[k]).filter(Boolean),
          features: featureCols.map(k => rowObj[k]).filter(Boolean),
          menus: menuCols
            .filter(k => rowObj[k])
            .map(k => ({
              name: k,
              price: parseInt(rowObj[k].replace(/[₩,]/g, ""))
            }))
        };
      });

      // ✅ 즐겨찾기 표시 함수 호출
      if (typeof displayFavorites === "function") {
        displayFavorites();
      }
    });
  });
});
</script>

</body>
</html>